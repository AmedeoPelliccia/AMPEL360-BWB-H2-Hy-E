{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ampel360.com/schemas/h2-sensor-schema.json",
  "title": "H2 Fuel System Sensor Schema",
  "description": "Schema for hydrogen fuel system sensor data feed",
  "type": "object",
  "properties": {
    "timestamp": {
      "type": "number",
      "description": "Unix timestamp (seconds since epoch with microsecond precision)",
      "minimum": 0
    },
    "flight_id": {
      "type": "string",
      "description": "Unique flight identifier",
      "pattern": "^FL-[0-9]{8}-[A-Z0-9]{6}$"
    },
    "tank_1": {
      "type": "object",
      "description": "H2 Tank 1 sensor readings",
      "properties": {
        "pressure_bar": {
          "type": "number",
          "description": "Pressure in bar (absolute)",
          "minimum": 0,
          "maximum": 350,
          "unit": "bar"
        },
        "temperature_kelvin": {
          "type": "number",
          "description": "Temperature in Kelvin",
          "minimum": 20,
          "maximum": 300,
          "unit": "K"
        },
        "level_percent": {
          "type": "number",
          "description": "Fill level percentage",
          "minimum": 0,
          "maximum": 100,
          "unit": "percent"
        },
        "flow_rate_kg_s": {
          "type": "number",
          "description": "Mass flow rate",
          "minimum": 0,
          "maximum": 50,
          "unit": "kg/s"
        },
        "valve_open": {
          "type": "boolean",
          "description": "Main valve position (true=open, false=closed)"
        },
        "leak_detected": {
          "type": "boolean",
          "description": "Leak detection status"
        }
      },
      "required": ["pressure_bar", "temperature_kelvin", "level_percent", "valve_open", "leak_detected"]
    },
    "tank_2": {
      "$ref": "#/$defs/tank_sensor_group"
    },
    "tank_3": {
      "$ref": "#/$defs/tank_sensor_group"
    },
    "tank_4": {
      "$ref": "#/$defs/tank_sensor_group"
    },
    "quality_flags": {
      "type": "object",
      "description": "Data quality indicators",
      "properties": {
        "sensor_health": {
          "type": "string",
          "enum": ["GOOD", "DEGRADED", "FAILED"],
          "description": "Overall sensor health status"
        },
        "data_validity": {
          "type": "boolean",
          "description": "True if all data passed validation"
        },
        "latency_ms": {
          "type": "number",
          "description": "Data age in milliseconds",
          "minimum": 0,
          "maximum": 1000
        }
      },
      "required": ["sensor_health", "data_validity"]
    }
  },
  "required": ["timestamp", "flight_id", "tank_1", "tank_2", "tank_3", "tank_4", "quality_flags"],
  "$defs": {
    "tank_sensor_group": {
      "type": "object",
      "properties": {
        "pressure_bar": {
          "type": "number",
          "minimum": 0,
          "maximum": 350
        },
        "temperature_kelvin": {
          "type": "number",
          "minimum": 20,
          "maximum": 300
        },
        "level_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "flow_rate_kg_s": {
          "type": "number",
          "minimum": 0,
          "maximum": 50
        },
        "valve_open": {
          "type": "boolean"
        },
        "leak_detected": {
          "type": "boolean"
        }
      },
      "required": ["pressure_bar", "temperature_kelvin", "level_percent", "valve_open", "leak_detected"]
    }
  },
  "examples": [
    {
      "timestamp": 1700000000.123456,
      "flight_id": "FL-20251117-A3F8C2",
      "tank_1": {
        "pressure_bar": 325.5,
        "temperature_kelvin": 22.3,
        "level_percent": 87.2,
        "flow_rate_kg_s": 12.5,
        "valve_open": true,
        "leak_detected": false
      },
      "tank_2": {
        "pressure_bar": 324.8,
        "temperature_kelvin": 22.5,
        "level_percent": 86.9,
        "flow_rate_kg_s": 0.0,
        "valve_open": false,
        "leak_detected": false
      },
      "tank_3": {
        "pressure_bar": 326.1,
        "temperature_kelvin": 22.1,
        "level_percent": 88.0,
        "flow_rate_kg_s": 0.0,
        "valve_open": false,
        "leak_detected": false
      },
      "tank_4": {
        "pressure_bar": 325.3,
        "temperature_kelvin": 22.4,
        "level_percent": 87.5,
        "flow_rate_kg_s": 0.0,
        "valve_open": false,
        "leak_detected": false
      },
      "quality_flags": {
        "sensor_health": "GOOD",
        "data_validity": true,
        "latency_ms": 15
      }
    }
  ]
}
